$(function(){function a(){try{var y=util.ReadLocalStore(v,'');if(y&&''!=y){var z=JSON.parse(y);if(z){var A=new Date;return z.expire<A.getTime()?(util.DelLocalStore(v),{}):z}}return{}}catch(B){return console.error(B),{}}}function b(){var y=new Date;y.setSeconds(y.getSeconds()+n),w.expire=y.getTime(),util.SaveLocalStore(v,w)}function c(y,z){m=y.timeLeft||y.time;y.play;if(w=a(),y.content){u=y.content;var B='';$.each(u,function(C,D){B+='<div class="cauhoi">',B+='<p class="tn-question-id"> C\xE2u h\u1ECFi '+(C+1)+': <span style="float: right;" id="as-'+C+'"></span></p>';var E=D.question,F=w[C];if(void 0==D.type||'1'==D.type){var G=E.match(/\{img:.+\}/gi);null!=G&&$.each(G,function(I,J){var K=J.substr(5,J.length-6);E=E.replace(J,'<img src="'+K+'"/>')}),G=E.match(/\$(-)?\d*\\\w+\{\d+\}(\{\d+\})?\$/g),null!=G&&$.each(G,function(I,J){var K='/latex/'+encodeURI(J.replace(/\$/g,''));E=E.replace(J,'<img src="'+K+'"/>')});var H=F&&1==F.type?F.value:null;B+='<p class="tn-question">'+E+'</p>',B+='<p class="tn-answer tn-answer-image">',$.each(D.answer,function(I,J){B+='<span>',B+=H&&H==I?'<input qid="'+C+'" id="answer_'+C+'_'+I+'" name="answer_'+C+'" type="radio" value="'+I+'" checked/>':'<input qid="'+C+'" id="answer_'+C+'_'+I+'" name="answer_'+C+'" type="radio" value="'+I+'" />',G=J.match(/\{img:.+\}/gi),null!=G&&$.each(G,function(K,L){var M=L.substr(5,L.length-6);J=J.replace(J,'<img src="'+M+'"/>')}),G=J.match(/\$(-)?\d*\\\w+\{\d+\}(\{\d+\})?\$/g),null!=G&&$.each(G,function(K,L){var M='/latex/'+encodeURI(L.replace(/\$/g,''));J=J.replace(J,'<img src="'+M+'"/>')}),B+='<label for="answer_'+C+'_'+I+'"><span></span>'+J+'</label>',B+='</span>'}),B+='</p>'}if('2'==D.type){var G=E.match(/\{\}/gi),H=F&&2==F.type?F.value:'';null==G?B+='<p class="tn-question"><span style="color:red">#Error</span></p>':($.each(G,function(I,J){E=E.replace(J,'<input qid="'+C+'" type="text" value="'+H+'" class="answer_input_'+C+'"/>')}),G=E.match(/\{img:.+\}/gi),null!=G&&$.each(G,function(I,J){var K=J.substr(5,J.length-6);E=E.replace(J,'<img src="'+K+'"/>')}),G=E.match(/\$(-)?\d*\\\w+\{\d+\}(\{\d+\})?\$/g),null!=G&&$.each(G,function(I,J){var K='/latex/'+encodeURI(J.replace(/\$/g,''));E=E.replace(J,'<img src="'+K+'"/>')}),B+='<p class="tn-question">'+E+'</p>')}B+='</div>'}),p.html(B),p.find('.cauhoi input[type="text"]').change(function(){var C=$(this),D=C.attr('qid');w[D]={value:C.val(),type:2},b()}),p.find('.cauhoi input[type="radio"]').click(function(){var C=$(this),D=C.attr('qid');w[D]={value:C.val(),type:1},b()})}h(m),z&&'function'==typeof z&&z()}function d(){TN_POPUP.hide()}function f(){if(!k)return!1;clearInterval(o);var y=[];return $.each(u,function(z,A){var B='';if(void 0==A.type||'1'==A.type){var C=$('input[type=\'radio\'][name=\'answer_'+z+'\']:checked');0<C.length&&(B=C.val())}if('2'==A.type)var B=$('.answer_input_'+z).val();y.push(B)}),x.emit('submitAnswer',{answers:y},function(z){z.error?TN_POPUP.show(z.message,null,null,null,null,null,!1):util.DelLocalStore(v)}),!1}function h(y){n=y,o=setInterval(function(){n--,0>=n&&(clearInterval(o),s.click()),r.html(Second2Minute(n))},1e3)}TN_POPUP.show('\u0110ang k\u1EBFt n\u1ED1i v\u1EDBi m\xE1y ch\u1EE7...','K\u1EBFt n\u1ED1i',null,null,null,!1);var j,k=!0,l=!1,m,n,o,p=$('#div_questions'),r=$('#tn-count-down'),s=$('#bt_endgame'),u,v,w={},x=io();x.on('connect',function(){TN_POPUP.hide()}),x.on('server-ready',function(y,z){z({'client-ready':!0,width:screen.width,height:screen.height}),v=y.key_store}),x.on('server-msg',function(y){k=!1,TN_POPUP.show(y.message)}),x.on('socket-ready',function(y){0==y.error?j==void 0&&(j={},bottons=[{caption:'B\u1EAFt \u0111\u1EA7u',callback:function(){x.emit('getdata',{a:'mvt',b:'2015'},function(z){0==z.error?c(z.data,function(){d()}):(k=!1,TN_POPUP.show(z.message))})}},{caption:'Tho\xE1t',callback:function(){window.location.href='/'}}],TN_POPUP.show('Em h\xE3y \u0111\u1ECDc k\u1EF9 c\xE2u h\u1ECFi v\xE0 \u0110I\u1EC0N v\xE0o ch\u1ED7 tr\u1ED1ng ho\u1EB7c CH\u1ECCN 1 trong 4 \u0111\xE1p \xE1n cho s\u1EB5n. N\u1EBFu CH\u1ECCN \u0111\xE1p \xE1n em h\xE3y click chu\u1ED9t v\xE0o \xF4 tr\xF2n tr\u01B0\u1EDBc \u0111\xE1p \xE1n. N\u1EBFu \u0110I\u1EC0N v\xE0o ch\u1ED7 tr\u1ED1ng, em h\xE3y \u0110I\u1EC0N ch\u1EEF c\xE1i, t\u1EEB, s\u1ED1, k\xFD hi\u1EC7u to\xE1n h\u1ECDc, ho\u1EB7c ph\xE9p t\xEDnh. Ch\xFA \xFD, ph\xE2n s\u1ED1 em \u0110I\u1EC0N theo d\u1EA1ng a/b.N\u1EBFu l\xE0 s\u1ED1 th\u1EADp ph\xE2n em d\xF9ng d\u1EA5u ch\u1EA5m, v\xED d\u1EE5 1.25 v\xE0 sau khi l\xE0m xong 10 c\xE2u h\u1ECFi em \u1EA5n n\xFAt n\u1ED9p b\xE0i.<br/>B\u1EA1n \u0111\xE3 s\xE3n s\xE0ng ch\u01B0a?','B\u1EAFt \u0111\u1EA7u',600,280,bottons,null,!1)):(k=!1,TN_POPUP.show(y.error_message,'C\u1EA3nh b\xE1o',null,null,null,null,!1),x.close())}),x.on('onData',function(y){0==y.error?c(y.data):TN_POPUP.show(y.message)}),x.on('onStart',function(){d()}),x.on('onEnd',function(y){if(l=!0,y.data_round){var z=y.data_round,A='';if(1<z.luot&&(A+='L\u01B0\u1EE3t thi: '+z.luot+'<br/>'),A+='T\u1ED5ng \u0111i\u1EC3m: '+z.total_score+'<br/>',A+='T\u1ED5ng th\u1EDDi gian: '+z.total_time+'<br/>',z.round_info&&0<z.round_info.length){var B=y.data_round.round_info;for(i=0;i<B.length;i++)A+='B\xE0i: '+(i+1)+'- \u0110i\u1EC3m: '+B[i].score+' - Th\u1EDDi gian: '+B[i].total_time+'<br/>'}var C=[];y.pass_round?(C.push({caption:'Thi ti\u1EBFp',callback:function(){window.location.href='../vong-'+(y.round_id+1)+'/bai-1'}}),A+='(B\u1EA1n \u0111\u01B0\u1EE3c thi v\xF2ng ti\u1EBFp theo)'):(C.push({caption:'Thi l\u1EA1i',callback:function(){window.location.href='bai-1'}}),A+='(B\u1EA1n ch\u01B0a qua v\xF2ng n\xE0y)'),C.push({caption:'Tho\xE1t',callback:function(){window.location.href='/'}}),TN_POPUP.show(A,'Th\xF4ng tin v\xF2ng thi '+y.round_id,400,280,C,null,!1)}else{var A='B\u1EA1n thi \u0111\u01B0\u1EE3c: '+y.score+' \u0111i\u1EC3m<br/>';A+='Th\u1EDDi gian: '+Second2Minute(y.time-y.timeLeft);var C=[{caption:'Thi ti\u1EBFp',callback:function(){window.location.href=y.next_url}}];TN_POPUP.show(A,null,null,null,C,null,!1)}}),x.on('disconnect',function(){k&&!l&&TN_POPUP.show('\u0110\xE3 ng\u1EAFt k\u1EBFt n\u1ED1i v\u1EDBi m\xE1y ch\u1EE7...','L\u1ED7i k\u1EBFt n\u1ED1i',null,null,null,null,!1)}),s.click(function(){return f()})});function Second2Minute(a){var b=Math.floor(a/60),c=a-60*b;return 10>b&&(b='0'+b),10>c&&(c='0'+c),b+':'+c}